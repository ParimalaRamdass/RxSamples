<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Rx Demo - Queries and Composition</title>
    <script src="Scripts/jquery-1.5.1.min.js" type="text/javascript"></script>
    <script src="Scripts/rx.js" type="text/javascript"></script>
    <script src="Scripts/rx.html.js" type="text/javascript"></script>
    <script src="Scripts/rx.jQuery.js" type="text/javascript"></script>
    <script type="text/javascript">
        function searchWikipedia(term) {
            return $.ajaxAsObservable({ url: "http://en.wikipedia.org/w/api.php", dataType: "jsonp", data: { action: "opensearch", search: term, format: "json"} })
                    .Select(function (d) { return d.data[1]; });
        }

        $(document).ready(function () {
            var input = $("#searchInput");
            var res = input.toObservable("keyup")
                           .Select(function (_) { return input.val(); })
                           .Throttle(500)
                           .DistinctUntilChanged()
                           .Select(function (term) { return searchWikipedia(term); })
                           .Switch();

            res.Subscribe(function (words) {
                $("#results").empty();
                $.each(words, function (_, word) {
                    $("#results").append("<li>" + word + "</li>");
                });
            });
        });
    </script>
</head>
<body>
    <h1>Rx Demo Page</h1>
    <b>Input: </b><input id="searchInput" /><br />
    <b>Results: </b><div id="results" />
</body>
</html>
